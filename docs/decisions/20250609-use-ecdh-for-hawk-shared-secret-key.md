# Use ECDH for Hawk Shared Secret Key

- Status: draft
- Deciders: No-Cash-7970
- Date: 2025-06-09
- Tags: dapp-connect, security

## Context and Problem Statement

[Using Hawk](20240821-use-hawk-for-dapp-connection-authentication-and-authorization.md) requires both the dApp and the dApp connect server to use a shared secret `key`. The shared secret key is not supposed to be known by any entity other than the dApp and the server. It is used by the dApp to make authenticated requests to the server and by the server to verify authenticated requests from the dApp. There needs to be a way to securely create this key and give it to both the dApp and the server.

## Decision Drivers

The same decision drivers behind the [decision to use Hawk](20240821-use-hawk-for-dapp-connection-authentication-and-authorization.md).

## Considered Options

- Elliptic-curve Diffie-Hellman (ECDH)
- Transmit the key in plaintext from the server to the dApp

## Decision Outcome

Chose to use Elliptic-curve Diffie-Hellman (ECDH) for establishing the shared secret key to be used for Hawk. The more details of key establishment scheme for the key will be documented in a later decision and explained in an [architecture diagram](../diagrams/README.md).

> [!NOTE]
> Before this decision was formally made and documented, a significant part of a key establishment scheme using ECDH was implemented for the dApp connect server.

### Positive Consequences

- No secret data is sent over the network
- Most dApps should be able to do ECDH, especially if a dApp connect SDK is available for a dApp to use
- If the X25519 variation of ECDH (ECDH using [Curve25519](https://en.wikipedia.org/wiki/Curve25519)) is used, it may be possible for an Algorand account key pair to be used for authenticating with the dApp connection server

### Negative Consequences

- More [threats](../threat-model/01-threats.md)

## Pros and Cons of the Options

### Elliptic-curve Diffie-Hellman

Elliptic-curve Diffie–Hellman (ECDH) is the elliptic-curve variant of the Diffie-Hellman (DH) protocol. ECDH is what allows the [Buttercup Desktop](https://github.com/buttercup/buttercup-desktop) password manager to securely connect to its [browser extension](https://github.com/buttercup/buttercup-browser-extension). Buttercup's mechanism for securely connecting its desktop app to its browser extension is similar to the dApp connect mechanism that needed for the desktop wallet.

- Pro: Commonly used key exchange protocol, so there are a libraries for doing it properly for a large number of languages. Go has the native `crypto/ecdh` package for it.
- Pro: No secret is transmitted in plaintext
- Con: The increased complexity can open the door to more [threats](../threat-model/01-threats.md)

### Transmit Shared Secret Key in Plaintext

The shared secret key would be generated by the dApp connect server and sent to the dApp in plaintext as a normal HTTP response.

- Pro: Very simple
- Con: Requires ignoring [THREAT-009](../threat-model/01-threats.md#threat-009-interception-of-http-communication-between-dapp-and-wallet-connection-server), the instance where a bad actor intercepts the communication between the dApp and the server

## Links

- Refines [Use Hawk for DApp Connection Authentication and Authorization](20240821-use-hawk-for-dapp-connection-authentication-and-authorization.md)
- [ECDH Key Exchange - Practical Cryptography for Developers](https://cryptobook.nakov.com/asymmetric-key-ciphers/ecdh-key-exchange)
- [Elliptic-curve Diffie–Hellman - Wikipedia](https://en.wikipedia.org/wiki/Elliptic-curve_Diffie%E2%80%93Hellman)
- [Diffie–Hellman key exchange - Wikipedia](https://en.wikipedia.org/wiki/Diffie%E2%80%93Hellman_key_exchange)
