# Use ECDH for Establishing DApp Connect Shared Secret Key

- Status: accepted
- Deciders: No-Cash-7970
- Date: 2025-06-11
- Tags: dapp-connect, security, backend

## Context and Problem Statement

[Using Hawk](20240821-use-hawk-for-dapp-connection-authentication-and-authorization.md) requires both the dApp and the dApp connect server to use the same shared secret key. This dApp connect shared secret key is not supposed to be known by any entity other than the dApp and the server. It is used by the dApp to send authenticated requests to the server and by the server to verify the dApp's authentication in requests. There needs to be a way to securely create this key and give it to both the dApp and the server.

## Decision Drivers

- Same decision drivers for the [decision to use Hawk](20240821-use-hawk-for-dapp-connection-authentication-and-authorization.md)

## Considered Options

- Elliptic-curve Diffie-Hellman (ECDH)
- Transmit the key in plaintext from the server to the dApp

## Decision Outcome

Chose to use Elliptic-curve Diffie-Hellman (ECDH) for establishing the dApp connect shared secret key to be used for Hawk. More details for the protocol for establishing the shared key will be documented in a later decision and explained in an [architecture diagram](../diagrams/README.md).

**Confidence:** High. Part of a key establishment protocol for the dApp connect shared secret key has been implemented using ECDH with no problems before this decision was formally made and documented.

### Positive Consequences

- No secret data is sent over the network
- Most dApps should be capable of using ECDH, especially if an SDK for dApp connect is available for a dApp to use
- If the X25519 variation of ECDH (ECDH using [Curve25519](https://en.wikipedia.org/wiki/Curve25519)) is used, it may be possible for an Algorand account key pair to be used for authenticating with the dApp connection server

### Negative Consequences

- More [threats](../threat-model/01-threats.md) due to the increase in complexity. Some of these new threats require deeper analysis of the dApp connect feature to be able to identify them.

## Pros and Cons of the Options

### Elliptic-curve Diffie-Hellman

Elliptic-curve Diffie–Hellman (ECDH) is the elliptic-curve (EC) variant of the Diffie-Hellman (DH) key exchange protocol. ECDH is what allows the [Buttercup Desktop](https://github.com/buttercup/buttercup-desktop) password manager to securely connect to its [browser extension](https://github.com/buttercup/buttercup-browser-extension). Buttercup's mechanism for securely connecting its desktop app to its browser extension is similar to the [dApp connect mechanism](20240102-use-local-server-to-connect-to-dapps.md) needed for the desktop wallet.

- Pro: A commonly used key exchange protocol, so there are a libraries for doing it properly in a large number of languages. Go has the native `crypto/ecdh` package for it.
- Pro: No secret is transmitted in plaintext, so it works for localhost where SSL/TLS is likely to be ineffective
- Con: The increased complexity can open the door to more [threats](../threat-model/01-threats.md)

### Transmit Shared Secret Key in Plaintext

The shared secret key would be generated by the server and sent to the dApp in plaintext as a normal HTTP response.

- Pro: Very simple
- Con: Requires ignoring [THREAT-009](../threat-model/01-threats.md#threat-009-interception-of-http-communication-between-dapp-and-wallet-connection-server), where a bad actor intercepts the transmission of the shared secret key and obtains the shared secret key that is unprotected by SSL/TLS on localhost

## Links

- Refines [Use Hawk for DApp Connection Authentication and Authorization](20240821-use-hawk-for-dapp-connection-authentication-and-authorization.md)
- Relates to [Terms for Parts of DApp Connect](20250609-terms-for-parts-of-dapp-connect.md)
- [ECDH Key Exchange - Practical Cryptography for Developers](https://cryptobook.nakov.com/asymmetric-key-ciphers/ecdh-key-exchange)
- [Elliptic-curve Diffie–Hellman - Wikipedia](https://en.wikipedia.org/wiki/Elliptic-curve_Diffie%E2%80%93Hellman)
- [Diffie–Hellman key exchange - Wikipedia](https://en.wikipedia.org/wiki/Diffie%E2%80%93Hellman_key_exchange)
